<!DOCTYPE html>
<html>
<head>
<title>Sign Up</title>
<style>
body { background: #5dade2; font-family: Arial; color:white; text-align:center; }
input { width:85%; padding:8px; margin:4px; }
button { padding:10px 20px; background:green; color:white; border:none; }
small { font-size:9px; }
</style>
</head>
<body>

<h2 style="font-size:14px;">PERSONAL DETAILS</h2>

<input id="name" placeholder="Name">
<input id="surname" placeholder="Surname">
<input id="idNumber" placeholder="ID Number">
<input id="email" placeholder="Email Address">
<input id="nationality" placeholder="Nationality">
<input id="cell" placeholder="Cell Number">

<br><br>

<input id="address" placeholder="Home Address">
<input id="suburb" placeholder="Suburb">
<input id="city" placeholder="City">
<input id="zip" placeholder="Zip Code">

<br><br>

<h2 style="font-size:14px;">Security</h2>

<input id="password" type="password" placeholder="Password">
<small>Minimum 8 characters</small><br>
<input id="confirm" type="password" placeholder="Confirm Password">
<small>Must match password</small>

<br><br>

<h2 style="font-size:14px;">BANK DETAILS</h2>

<input id="bank" placeholder="Bank Name">
<input id="account" placeholder="Account Number">

<br><br>
<button onclick="signup()">SUBMIT</button>

<script type="module">
import { auth, db } from "./firebase.js";
import { createUserWithEmailAndPassword } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { ref, set, get } from
"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

window.signup = async () => {

  if (password.value.length < 8) return alert("Password too short");
  if (password.value !== confirm.value) return alert("Passwords do not match");

  const idRef = ref(db, "idIndex/" + idNumber.value);
  const idSnap = await get(idRef);

  if (idSnap.exists()) {
    alert("ID Number already registered");
    return;
  }

  try {
    const userCred = await createUserWithEmailAndPassword(
      auth,
      email.value.toLowerCase(),
      password.value
    );

    const uid = userCred.user.uid;

    await set(ref(db, "users/" + uid), {
      personal: {
        name: name.value,
        surname: surname.value,
        idNumber: idNumber.value,
        email: email.value.toLowerCase(),
        nationality: nationality.value,
        cell: cell.value,
        address: address.value,
        suburb: suburb.value,
        city: city.value,
        zip: zip.value
      },
      bank: {
        bankName: bank.value,
        accountNumber: account.value
      },
      wallet: {
        balance: 0,
        lives: 0
      },
      winnings: {
        amount: 0,
        claimed: false
      }
    });

    await set(idRef, uid);

    alert("Registered successfully");
    window.location.href = "index.html";

  } catch (e) {
    alert(e.message);
  }
};
</script>

</body>
</html>
