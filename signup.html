<script type="module">
import { auth, db } from "./firebase.js";
import {
  createUserWithEmailAndPassword
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { ref, get, set } from
"https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

async function submit() {
  const idNumber = id.value.trim();
  const snap = await get(ref(db, "ids/" + idNumber));
  if (snap.exists()) return alert("ID already exists");

  const user = await createUserWithEmailAndPassword(auth, email.value, password.value);

  await set(ref(db, "ids/" + idNumber), true);
  await set(ref(db, "players/" + user.user.uid), {
    name: name.value,
    surname: surname.value,
    id: idNumber,
    email: email.value,
    nationality: nationality.value,
    cell: cell.value,
    address: address.value,
    suburb: suburb.value,
    city: city.value,
    zip: zip.value,
    bank: { name: bank.value, account: account.value },
    created: Date.now()
  });

  location.href="index.html";
}
</script>
